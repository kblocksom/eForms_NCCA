---
title: ""
author: ""
date: ""
params:
  userDataRMD: 'NULL'
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(kableExtra))


```



```{r, echo=FALSE, messages=FALSE}

include_graphics("NCCA logo_sm.jpg")

# Verification and habitat info
verification <- dplyr::filter(params[['userDataRMD']][['VERIFICATION']][[1]], PARAMETER %in% c('SITE_ID','VISIT_NO', "DATE_COL","STATE","LOC_NAME","CREW",
                                                                                               "VALXSITE",'STATION_DEPTH',
                                                                                               "DRCTNS","CREW_LEADER")) %>%
  select(PARAMETER, RESULT)

verification_tbl <- filter(verification, !(PARAMETER %in% c("CREW","DRCTNS"))) %>%
  mutate(PARAMETER = dplyr::recode(PARAMETER, "SITE_ID"='Site ID',"STATE"='State',"VISIT_NO"='Visit Number',
                                   "DATE_COL"='Sample Date',
                                   "LOC_NAME"='Location',"VALXSITE"='Sample Type', 
                                   "STATION_DEPTH"= 'Station Depth (m)' ,
                                   "CREW_LEADER"='Crew Leader'))

habitat <- dplyr::filter(params[['userDataRMD']][['VERIFICATION']][[1]], PARAMETER %in% c('HABITAT','BOTTOM_TYPE','MARINE_DEBRIS','SAV','SAV_ABUNDANCE','MACROALGAE'
,'MACRO_ABUNDANCE','MARINE_DEBRIS_TYPE'))

habitat_tbl <- mutate(habitat, PARAMETER=dplyr::recode(PARAMETER, 'HABITAT'='Habitat Type','MARINE_DEBRIS'='Marine debris',
                                                       'BOTTOM_TYPE'='Bottom type',
                                                       'SAV'='Submerged Aquatic Vegetation (SAV)?','MACROALGAE'='Macroalgae?',
                                                       'SAV_ABUNDANCE'='SAV abundance','MACRO_ABUNDANCE'='Macroalgae abundance')) %>%
  select(PARAMETER,RESULT)



## Assessment info
assessment <- dplyr::filter(params[['userDataRMD']][['ASSESSMENT']][[1]], PARAMETER %in% c('WEATHER','DOM_LAND_USE','FOR_AGE_CLASS',
                                                                                           'TRASH_PLASTIC_BOTTLES','TRASH_OTHER_PLASTIC',
                                                                                           'TRASH_OTHER','FISHING_GEAR','TRASH_ALUMINUM_CANS',
                                                                                           'TRASH_TIRES')) %>% 
  dplyr::select(PARAMETER, RESULT) %>%
  mutate(PARAMETER = recode(PARAMETER,"DOM_LAND_USE"='Shoreline dominant land use', 
                            "WEATHER"= 'Weather',"FOR_AGE_CLASS"= 'Shoreline forest age class','TRASH_PLASTIC_BOTTLES'='Plastic bottle trash',
                            'TRASH_OTHER_PLASTIC'='Other plastic trash','TRASH_OTHER'='Other trash','TRASH_TIRES'='Tires',
                            'FISHING_GEAR'='Fishing gear trash','TRASH_ALUMINUM_CANS'='Aluminum can trash'),
         group = PARAMETER) %>%
  mutate(group= recode(group, 'Shoreline dominant land use'=2,'Weather'= 1,'Shoreline forest age class'= 3,'Aluminum can trash' = 4,
                       'Plastic bottle trash'=5,'Other plastic trash'=6,'Fishing gear trash'=7,'Tires'=8,'Other trash'=9)) %>%
  arrange(group) %>%
  dplyr::select(-group) 
  

## samples collected
# generic samples and description
samples <- tibble(Sample = c('CHEM', 'WCHL', 'NUTS', 'MICX', 'ENTE','BENT','PHYT','SEDO','SEDX','SEDC','SEDG'),
                  `Sample Name` = c('Water Chemistry','Water Chlorophyll a','Nutrients',
                                    'Microcystin & Cylindrospermopsin', 'Enterococci','Benthic Macroinvertebrates',
                                    'Phytoplankton','Sediment Organics','Sediment Toxicity',
                                    'Sediment TOC','Sediment Grain Size'),
                  Description = c('Basic anions & cations, turbidity, organic carbon, pH',
                                  'Chlorophyll a content in water sample','Phosphorus and nitrogen',
                                  'Analyzed for algal toxins in water','*E.coli* and enterococci',
                                  'Benthic macroinvertebrate composition','Algal species composition',
                                  'Organic contaminants in sediments', 'Sediments for toxicity testing','Sediment total organic carbon',
                                  'Sediment grain size'))
# filter to only what was collected
samplesTaken <- unique(params[['userDataRMD']][['SAMPLE']][[1]]$SAMPLE_TYPE)[!(unique(params[['userDataRMD']][['SAMPLE']][[1]]$SAMPLE_TYPE) %in% 'SAMP')]
samples_tbl <- filter(samples, Sample %in% samplesTaken) %>%
  distinct(`Sample Name`, .keep_all=TRUE) %>%
  dplyr::select(`Sample Name`, Description)

## Profile - skip secchi because might be too confusing to lay person
profile_tbl <- filter(params[['userDataRMD']][['PROFILE']][[1]], 
                      PARAMETER %in% c('DEPTH','TEMPERATURE','DO','PH','CONDUCTIVITY')) %>%
  select(LINE,PARAMETER,RESULT) %>%
  mutate(PARAMETER=recode(PARAMETER, "DEPTH"='Depth (m)','TEMPERATURE'='Temperature (C)',
                          'DO'='Dissolved Oxygen (mg/L)','CONDUCTIVITY'='Conductivity uS/cm','PH'='pH')) %>%
  dcast(LINE~PARAMETER,value.var='RESULT') %>%
  arrange(LINE) %>%
  select('Depth (m)','Dissolved Oxygen (mg/L)','Temperature (C)','pH','Conductivity uS/cm')


```

##National Rivers and Streams Assessment Landowner Report

#### About
This report provides landowners with preliminary data available after sampling. Additional information can be provided to you after laboratory analyses are completed. If you would like to be notified when this information is available, please contact the Crew Leader.



```{r row 1 tables, echo=F}  
kable(verification_tbl,col.names=c('Station Information',''), align=c('l','r')) %>%
  kable_styling(bootstrap_options = 'condensed', full_width = F, position = "left") %>%
  column_spec(1, border_right = T) %>%
  column_spec(2, width = "15em")

kable(habitat_tbl,col.names=c('Habitat Data',''), align=c('l','r')) %>%
  kable_styling(bootstrap_options = 'condensed', full_width = F, position = "left") %>%
  column_spec(1, border_right = T, width = "10em") %>%
  column_spec(2, width = "15em")

kable(assessment ,col.names=c('Field Assessment',''), align=c('l','r')) %>%
  kable_styling(bootstrap_options = 'condensed', full_width = F, position = "left") %>%
  column_spec(1, border_right = T, width = "10em") %>%
  column_spec(2, width = "15em")

```




```{r row 2 tables, echo=F}
kable(samples_tbl, align=c('l','r')) %>%
  add_header_above(c('Samples Sent for Laboratory Analysis'=2)) %>%
  kable_styling(bootstrap_options = 'condensed', full_width = F, position = "float_left") %>%
  column_spec(1, border_right = T, width = "15em") %>%
  column_spec(2, width = "15em")

kable(profile_tbl, align=c('l','c','c','c','c')) %>%
  add_header_above(c("Depth profile" = 5)) %>%
  kable_styling(bootstrap_options = 'condensed', full_width = F, position = "float_left") %>%
  column_spec(1, border_right = T, width = "12em") %>%
  column_spec(2, width = "8em") %>%
  column_spec(3, width = "8em") %>%
  column_spec(4, width = "8em") %>%
  column_spec(5, width = "8em")

```


